# Bug Report: Bootstrap Routes to V1 Handler Instead of V2

**Reported by:** Axiom (Test Manager)
**Date:** 2025-12-30
**Severity:** BLOCKER - Nothing works without bootstrap

## Summary
The `bootstrap` endpoint is routed to the V1 handler which doesn't create instance directories or files. The V2 handler (which does the real work) is only accessible via `bootstrap_v2`.

## The Disconnect
| Layer | Expects |
|-------|---------|
| MCP Tool Definitions | V2 behavior (creates dirs, returns instanceId) |
| Actual Routing | V1 behavior (returns context only, no filesystem effects) |

## Root Cause
`/mnt/coordinaton_mcp_data/worktrees/foundation/src/server.js`:

```javascript
// Line 9: Imports V1 bootstrap
import { bootstrap } from './bootstrap.js';

// Line 23: Imports V2 bootstrap as different name
import { bootstrap as bootstrapV2 } from './v2/bootstrap.js';

// Lines 168-171: Routes 'bootstrap' to V1 handler
case 'bootstrap':
  return await bootstrap(params);  // <-- BUG: calls V1

// Lines 292-293: V2 only available as 'bootstrap_v2'
case 'bootstrap_v2':
  return bootstrapV2(params);      // <-- This is correct handler
```

## Reproduction Steps
1. Call `bootstrap({ name: "TestInstance" })` via MCP
2. Response shows `success: true` with V1-style structure (no real instanceId)
3. Check filesystem: `/mnt/coordinaton_mcp_data/instances/TestInstance-*/` does NOT exist

## Expected Behavior
- Directory created: `/mnt/coordinaton_mcp_data/instances/{instanceId}/`
- Files created: `preferences.json`, `diary.md`
- Response includes: real `instanceId`, `xmpp` credentials, `recoveryKey`

## Actual Behavior
- No directory created
- Response returns V1 structure with `instance_id: "anonymous"`

## Suggested Fix
Change lines 170-171 in `server.js` from:
```javascript
case 'bootstrap':
  return await bootstrap(params);
```
To:
```javascript
case 'bootstrap':
  return await bootstrapV2(params);
```

## Impact
- **Blocks:** ALL identity-dependent operations (introspect, messaging, tasks, everything)
- **Phase 1-5 testing:** Cannot proceed until fixed

## Evidence
- Existing working instances (Lupo-f63b, Messenger-7e2f) have correct directory structure
- These were likely created before the routing broke, or via direct `bootstrap_v2` calls

## Files Involved
| File | Lines | Issue |
|------|-------|-------|
| `src/server.js` | 9, 23, 168-171 | Wrong routing |
| `src/bootstrap.js` | 245-355 | V1 handler (doesn't create files) |
| `src/v2/bootstrap.js` | 538-916 | V2 handler (correct behavior) |

---
*Report generated by Axiom - Test Manager*
*Investigation performed by agent a0e2ba2*
